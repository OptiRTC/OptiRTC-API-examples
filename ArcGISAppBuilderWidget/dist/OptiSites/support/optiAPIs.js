var __awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(a,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function i(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,i)}u((n=n.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var r,n,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},__await=this&&this.__await||function(t){return this instanceof __await?(this.v=t,this):new __await(t)},__asyncGenerator=this&&this.__asyncGenerator||function(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(t,e||[]),o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(t){a[t]&&(n[t]=function(e){return new Promise((function(r,n){o.push([t,e,r,n])>1||i(t,e)}))})}function i(t,e){try{(r=a[t](e)).value instanceof __await?Promise.resolve(r.value.v).then(u,c):l(o[0][2],r)}catch(t){l(o[0][3],t)}var r}function u(t){i("next",t)}function c(t){i("throw",t)}function l(t,e){t(e),o.shift(),o.length&&i(o[0][0],o[0][1])}},__asyncValues=this&&this.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,a){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,a,(e=t[r](e)).done,e.value)}))}}},__asyncDelegator=this&&this.__asyncDelegator||function(t){var e,r;return e={},n("next"),n("throw",(function(t){throw t})),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,a){e[n]=t[n]?function(e){return(r=!r)?{value:__await(t[n](e)),done:"return"===n}:a?a(e):e}:a}},__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};define(["require","exports","../js/unfetch"],(function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getAllOptiItemsFlattened=e.getAllOptiItems=e.optiAPIGet=void 0,r=__importDefault(r);var n=fetch||r.default,a="/api/",o="https://public.optirtc.com/api/",s=function(t,e,r){var n=function(t){return"string"==typeof t?t:"boolean"==typeof t||"number"==typeof t?""+t:null}(r);"string"==typeof n&&t.append(e,n)};e.optiAPIGet=function(t,e,r){return __awaiter(void 0,void 0,void 0,(function(){var i,u,c;return __generator(this,(function(l){switch(l.label){case 0:return i=new URL(t.startsWith(o)?t:""+o+t),e&&(i.search=function(t,e){return void 0===e&&(e={}),Object.keys(e).reduce((function(t,r){var n=e[r];return Array.isArray(n)?n.forEach((function(e){return s(t,r,e)})):s(t,r,n),t}),new URLSearchParams({key:t}))}(e,r).toString()),[4,n(i.toString())];case 1:if(!((u=l.sent()).status>=200&&u.status<300))throw t=i.pathname.slice(a.length),c=i.search,Object.assign(new Error("GET "+t+c+": XHR Status "+u.status+": "+u.statusText),{request:{endpoint:t,search:c},response:u});return[2,u.json()]}}))}))};var i=function(t){return t&&Array.isArray(t.Items)};e.getAllOptiItems=function(t,r,n){var a;return(a={})[Symbol.asyncIterator]=function(){return __asyncGenerator(this,arguments,(function(){var a,o,s;return __generator(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,4]),[4,__await(e.optiAPIGet(r,t,n))];case 1:return a=u.sent(),[3,4];case 2:return o=u.sent(),console.error(o),[4,__await(void 0)];case 3:return[2,u.sent()];case 4:return a?i(a)?[4,__await(a.Items)]:[3,13]:[3,17];case 5:return[4,u.sent()];case 6:if(u.sent(),!a.NextPageLink)return[3,11];u.label=7;case 7:return u.trys.push([7,9,,10]),[4,__await(e.optiAPIGet(a.NextPageLink))];case 8:return a=u.sent(),[3,10];case 9:return s=u.sent(),console.error("next page error:",s),[3,17];case 10:return[3,12];case 11:return[3,17];case 12:return[3,16];case 13:return[4,__await([a])];case 14:return[4,u.sent()];case 15:return u.sent(),[3,17];case 16:return[3,4];case 17:return[2]}}))}))},a};e.getAllOptiItemsFlattened=function(t,r,n){var a;return(a={})[Symbol.asyncIterator]=function(){return __asyncGenerator(this,arguments,(function(){var a,o,s,i,u,c;return __generator(this,(function(l){switch(l.label){case 0:l.trys.push([0,7,8,13]),a=__asyncValues(e.getAllOptiItems(t,r,n)),l.label=1;case 1:return[4,__await(a.next())];case 2:return(o=l.sent()).done?[3,6]:(s=o.value,[5,__values(__asyncDelegator(__asyncValues(s)))]);case 3:return[4,__await.apply(void 0,[l.sent()])];case 4:l.sent(),l.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return i=l.sent(),u={error:i},[3,13];case 8:return l.trys.push([8,,11,12]),o&&!o.done&&(c=a.return)?[4,__await(c.call(a))]:[3,10];case 9:l.sent(),l.label=10;case 10:return[3,12];case 11:if(u)throw u.error;return[7];case 12:return[7];case 13:return[2]}}))}))},a}}));